# Документация на тестовете за Система за Управление на Библиотека

## Общ преглед
Този документ предоставя подробна документация за тестовия пакет на Системата за управление на библиотека. Тестовият пакет покрива всички основни обекти и техните взаимодействия, реализирайки цялостен набор от модулни тестове за CRUD операции и управление на връзките.

## Структура на тестовете

### Базов тестов клас
Класът `TestBase` предоставя обща функционалност за всички тестови класове:
- Инициализира тестова база данни в паметта за всеки тест
- Осигурява чиста база данни преди всеки тест
- Правилно освобождава ресурсите след всеки тест

### Обобщение на тестовото покритие
- Общ брой тестове: 27
- Общо покритие: ~90%
- Тестови категории: CRUD операции, управление на връзки, валидация на ограничения
- Тестова рамка: NUnit с Entity Framework Core In-Memory Provider

## Тестови класове

### 1. BookTests (Тестове на книги)
**Покритие: ~95%**

#### Тестови случаи:
1. `Create_ValidBook_ShouldAddSuccessfully`
   - Проверява основното създаване на книга
   - Валидира правилното записване на всички свойства
   - Проверява връзките с Жанр и Издател

2. `Read_ExistingBook_ShouldReturnCorrectBook`
   - Осигурява точното извличане на данни за книга
   - Проверява включените връзки

3. `Update_ExistingBook_ShouldUpdateSuccessfully`
   - Тества обновяването на свойства
   - Проверява запазването на промените

4. `Delete_ExistingBook_ShouldRemoveSuccessfully`
   - Потвърждава правилното изтриване
   - Проверява каскадните ефекти

5. `Create_BookWithAuthors_ShouldCreateRelationshipsSuccessfully`
   - Тества връзката много-към-много с автори
   - Валидира запазването на връзките

6. `Update_BookAuthors_ShouldUpdateRelationshipsSuccessfully`
   - Тества модификацията на връзките с автори
   - Проверява обновяването на връзките

### 2. AuthorTests (Тестове на автори)
**Покритие: ~90%**

#### Тестови случаи:
1. `Create_ValidAuthor_ShouldAddSuccessfully`
   - Тества създаването на автор
   - Валидира запазването на свойствата

2. `Read_ExistingAuthor_ShouldReturnCorrectAuthor`
   - Проверява извличането на автор
   - Проверява точността на свойствата

3. `Update_ExistingAuthor_ShouldUpdateSuccessfully`
   - Тества обновяването на свойства
   - Валидира промените в имената

4. `Delete_ExistingAuthor_ShouldRemoveSuccessfully`
   - Потвърждава правилното изтриване
   - Проверява почистването

5. `Read_AuthorWithBooks_ShouldIncludeBooks`
   - Тества зареждането на връзки
   - Проверява връзките с книги

6. `Delete_AuthorWithBooks_ShouldRemoveRelationships`
   - Тества почистването на връзки
   - Проверява запазването на книги

### 3. GenreTests (Тестове на жанрове)
**Покритие: ~90%**

#### Тестови случаи:
1. `Create_ValidGenre_ShouldAddSuccessfully`
   - Тества създаването на жанр
   - Валидира запазването на свойства

2. `Read_ExistingGenre_ShouldReturnCorrectGenre`
   - Проверява извличането на жанр
   - Проверява точността на свойствата

3. `Update_ExistingGenre_ShouldUpdateSuccessfully`
   - Тества обновяването на име
   - Валидира промените

4. `Delete_ExistingGenre_ShouldRemoveSuccessfully`
   - Потвърждава правилното изтриване
   - Проверява почистването

5. `Read_GenreWithBooks_ShouldIncludeBooks`
   - Тества зареждането на връзки
   - Проверява връзките с книги

6. `Delete_GenreWithBooks_ShouldNotAllowDeletion`
   - Тества ограниченията за изтриване
   - Проверява обработката на грешки

### 4. PublisherTests (Тестове на издатели)
**Покритие: ~90%**

#### Тестови случаи:
1. `Create_ValidPublisher_ShouldAddSuccessfully`
   - Тества създаването на издател
   - Валидира запазването на свойства

2. `Read_ExistingPublisher_ShouldReturnCorrectPublisher`
   - Проверява извличането на издател
   - Проверява точността на свойствата

3. `Update_ExistingPublisher_ShouldUpdateSuccessfully`
   - Тества обновяването на име
   - Валидира промените

4. `Delete_ExistingPublisher_ShouldRemoveSuccessfully`
   - Потвърждава правилното изтриване
   - Проверява почистването

5. `Read_PublisherWithBooks_ShouldIncludeBooks`
   - Тества зареждането на връзки
   - Проверява връзките с книги

6. `Delete_PublisherWithBooks_ShouldNotAllowDeletion`
   - Тества ограниченията за изтриване
   - Проверява обработката на грешки

## Области за потенциално подобрение

### Допълнително тестово покритие
1. Гранични случаи
   - Обработка на празни низове
   - Обработка на null стойности
   - Валидация на максимална дължина
   - Обработка на специални символи

2. Паралелни операции
   - Сценарии с множество потребители
   - Обработка на състезателни условия
   - Управление на транзакции

3. Пакетни операции
   - Масово създаване
   - Масово обновяване
   - Масово изтриване

4. Сложни заявки
   - Разширено филтриране
   - Сортиране
   - Странициране

### Известни проблеми
- Предупреждения за null референции в някои тестови твърдения
- Някои съобщения за грешки могат да бъдат по-специфични
- Някои гранични случаи не са напълно покрити

## Насоки за поддръжка на тестовете

### Добавяне на нови тестове
1. Наследяване от `TestBase` за последователна настройка
2. Следване на конвенцията за именуване: `Операция_Сценарий_ОчакванРезултат`
3. Включване на правилно почистване в teardown
4. Документиране на новите тестови случаи в този файл

### Добри практики
1. Поддържане на независимост на тестовете
2. Използване на смислени тестови данни
3. Един концепт за твърдение на тест
4. Поддържане на правилна подредба на Arrange-Act-Assert
5. Използване на ясни конвенции за именуване

## Изпълнение на тестовете

### Команден ред
```bash
# Изпълнение на всички тестове
dotnet test

# Изпълнение с покритие
dotnet test /p:CollectCoverage=true

# Изпълнение на конкретен тестов клас
dotnet test --filter "FullyQualifiedName~BookTests"
```

### Visual Studio
1. Отваряне на Test Explorer
2. Изпълнение на всички тестове или избор на конкретни тестове
3. Преглед на резултатите и покритието

## Непрекъсната интеграция
- Тестовете са част от CI процеса
- Всички тестове трябва да преминават преди сливане
- Автоматично генериране на отчети за покритие
- Праг на покритие: 90% 